# Исправление URL с несуществующими файлами

## Проблема

URL-адреса в базе данных указывают на старый bucket (`1f48199c-cfe29ccc-c471-493c-b13e-fadb10f330bc`), а в конфигурации используется новый bucket (`79dfaf80-vospitatel`). Это приводит к тому, что ссылки ведут на несуществующие файлы.

## Решение

### Вариант 1: Файлы были перенесены в новый bucket

Если файлы физически были перенесены из старого bucket в новый, нужно обновить URL в базе данных:

1. **Сделайте резервную копию БД:**
   ```bash
   pg_dump -h a872ea89bc23416a7de81d8c.twc1.net -U gen_user -d default_db > backup_before_bucket_migration.sql
   ```

2. **Запустите миграцию:**
   ```bash
   psql -h a872ea89bc23416a7de81d8c.twc1.net -U gen_user -d default_db -f migrate-bucket-name.sql
   ```

3. **Перезапустите бэкенд:**
   ```bash
   pm2 restart backend
   # или
   npm run start:prod
   ```

### Вариант 2: Файлы НЕ были перенесены в новый bucket

Если файлы все еще находятся в старом bucket, нужно:

1. **Перенести файлы из старого bucket в новый** (используя инструменты S3 или скрипт миграции)

2. **Или изменить конфигурацию**, чтобы использовать старый bucket:
   ```env
   S3_BUCKET_NAME=1f48199c-cfe29ccc-c471-493c-b13e-fadb10f330bc
   ```

3. **Или обновить URL в БД** после переноса файлов (см. Вариант 1)

## Проверка

После выполнения миграции проверьте:

```sql
-- Проверка life_in_dou
SELECT "mediaItems" FROM life_in_dou LIMIT 1;

-- Проверка folders
SELECT "mediaItems" FROM folders LIMIT 1;
```

URL должны содержать новый bucket name: `79dfaf80-vospitatel`

## Примечания

- Код автоматически преобразует старые URL в новые при возврате данных через API
- Если файлы не были перенесены, URL будут указывать на несуществующие файлы даже после миграции
- Убедитесь, что файлы физически существуют в новом bucket перед выполнением миграции


